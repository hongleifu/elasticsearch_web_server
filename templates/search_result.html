{% extends 'commons/_proto.html' %} 
{% from 'commons/navbar_toutiao.html' import macro_body_navbar %}

{% block body %}
{{ macro_body_navbar() }}

  <div class="row">
    <div class="search-div">
      <div class="form-group input-group">
        <span class="input-group-addon">宜信头条</span>
        <input type="text" class="form-control" id="search_input" value='{{query}}' onkeypress="if(event.keyCode==13) {search()}" />
        <div class="input-group-btn">
            <button class="btn btn-default" onClick="javascript:search()"><i class="glyphicon glyphicon-search"></i></button>
        </div>
      </div>
      <br/>
      
      <div id="search_result" style="text-align: left">
        {% for article in articles %}
        <div>
          <font size=3 color=blue> <a style="color: inherit; text-decoration: underline"
            href="{{article['_source']['article_url']}}">{{article['_source']['title']|safe}}</a>
          </font>
        </div>
        <div style="height: 40px; overflow: hidden; text-overflow: ellipsis">
          <a style="color: inherit" href="{{article['_source']['article_url']}}"><p>{{article['_source']['content']|safe}}</p></a>
        </div>
        <br/>
        {%endfor%}
      </div>
    </ul>
    
    <div>
      <ul class="sync-pagination pagination-sm" id="pagination"></ul>
    </div>
    
    {%if recommend_keyword %}
    <div id="recommend_result_keyword" style="position: relative; width: 15%; top: 20px; text-align: left; float: right">
      <font size=4 color='orange'><p>相关搜索:</p> <br></font> 
      {% for data in recommend_keyword%} 
        <font size=4 color='blue'><a href="javascript:search_key('{{data}}')" color='inherit'>{{data}}</a></font> <br>
      {%endfor%}
    </div>
    {%endif%}
    </div>
  </div>

  <script src="lib/jquery.twbsPagination.min.js" type="text/javascript"></script>
  <script type="text/javascript" charset="utf-8">

    var pageNo = {{no}};
    var pageSize = {{size}};
    var totalCount = {{totalsize}};
    var query = $('#search_input').val()
    var totalPages = Math.ceil(totalCount/pageSize);
  
    $('.sync-pagination').twbsPagination({
        startPage: pageNo,
        totalPages: totalPages,
        first: '首页',
        prev: '前一页',
        next: '下一页',
        last: '末页',
        onPageClick: function (evt, page) {
            if (page == pageNo) {
                console.debug("current page number clicked, do nothing.");
                return;
            }
            var url = "/searchpage?query=" + query + "&no=" + page + "&size=" + pageSize;
            console.debug("pageurl:", url);
            window.location.href = url;
        }
    });
  
	function post(URL, PARAMS) {
        var temp = document.createElement("form");
        temp.action = URL;
        temp.method = "post";
        temp.style.display = "none";
        for ( var x in PARAMS) {
            var opt = document.createElement("textarea");
            opt.name = x;
            opt.value = PARAMS[x];
            temp.appendChild(opt);
        }
        document.body.appendChild(temp);
        temp.submit();
        return temp;
    }
    function search() {
        post("/search", {
            "query" : document.getElementById("search_input").value
        });
    }
    function search_key(word) {
        document.getElementById("search_input").value = word
        post("/search", {
            "query" : document.getElementById("search_input").value
        });
    }
</script>
{% endblock %}
