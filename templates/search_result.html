<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <link rel="stylesheet" href="../stylesheets/core.css" />
    <link rel="stylesheet" href="../stylesheets/iconfont.css" />
</head>

<body>
    {% include "commons/body_top.html" %}
    <div id="body ">
        <div class="container ">
            <div class="cards page">
                <div class="mian-container">
                    <div class="section">
                        <div class="media-content post-list">
                            {% for article in articles  %}
                            <div class="item">
                                <div class="content">
                                    <h4><a href="{{article['_source']['url']}}" target="_blank">{{article['_source']['title']|safe}}</a></h4>
                                    <p style="height: 39px; overflow: hidden; text-overflow: ellipsis" >{{article['_source']['content']|safe}}</p>
                                    {% if article['_source']['imgs'] %}
                                        <ul>
                                            {% for img in article['_source']['imgs']%}
                                                <li>
                                                    <img src="{{img}}">
                                                </li>
                                             {% endfor %}
                                        </ul>
                                    {% endif %}
                                    <div class="block-bar">
                                        {% if article['_source']['source_url']  %}
                                        <span><a href="#">{{article['_source']['source_url']}}</a></span>
                                        {% else %}
                                        <span>{{article['_source']['publish_time_str']|safe}}</span>
                                        {% if article['_source']['author'] %}
                                            <span>{{article['_source']['author']|safe}}</span>
                                        {% endif %}
                                        {% endif %}
                                        <div class="control-right">
                                            <div class="row-1x">
                                                <div class="group-span-1x"><span>来自：<a href="#">{{article['_source']['source_site_name']|safe}}</a></span><span></span></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="blk-2x"></div>
                    <ul id="page" class="pagination" >
                    </ul>
                </div>
                <div class="side-container">
                    {%if recommend_keyword %}
                    <div class="section heading"><h4>相关搜索</h4></div>
                   <ul class="list md">
                        {% for data in recommend_keyword%}
                        <li>
                            <a href="http://jinrongdao.creditease.cn/search?query={{data}}"><p>{{data}}</p>
                        </li>
                        <div class="blk-1x"></div>
                        {% endfor %}
                   
                    {% endif %}
                    {% if adverses and adverses[0] %}
                    <div class="section heading"><h4>推广</h4></div>
                    <div class="row">
                        {% for adverse in adverses %}
                        <div class="col-md-6">
                            <div class="card-image">
                                <div class="img">
                                    <a href="{{adverse['targetUrl']}}" onclick="click_adverse({{adverse['id']}},'{{query}}')" target="_blank"><img src="{{adverse['imgUrl']}}"></a>
                                </div>
                                <div class="card-title">
                                    <a href="{{adverse['targetUrl']}}" onclick="click_adverse({{adverse['id']}},'{{query}}')" target="_blank">{{adverse['adverseDescribe']}}</a>
                                </div>
                                <div class="card-content"></div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
            <div class="divider solid "></div>
        </div>
    </div>
    <div id="footer ">
        <div class="copyright">CreditEase© 京ICP备12016237号-1 版权所有 普信恒业科技发展(北京)有限公司</div>
    </div>
    <script src="../lib/jquery-1.8.1.min.js "></script>
    <script src="../lib/bootstrap/js/bootstrap.min.js "></script>
    <script src="lib/jquery.twbsPagination.min.js" type="text/javascript"></script>
    <script type="text/javascript" charset="utf-8">
        var pageNo = {{no}};
        var pageSize = {{size}};
        var totalCount = {{total_size}};
        var query = $('#search_input').val();
        var totalPages = Math.ceil(totalCount/pageSize);
        if (totalCount>0){
            $('.pagination').twbsPagination({
                startPage: pageNo,
                totalPages: totalPages,
                first: '首页',
                prev: '前一页',
                next: '下一页',
                last: '末页',
                onPageClick: function (evt, page) {
                    if (page == pageNo) {
                        console.debug("current page number clicked, do nothing.");
                        return;
                    }
                    var url = "/searchpage?query=" + query + "&no=" + page + "&size=" + pageSize;
                    console.debug("pageurl:", url);
                    window.location.href = url;
                }
            });
        }
        function click_adverse(id,query) {
          var data={};
          data['id']=id;
          data['query']=query;
          $.ajax({
            type:'POST',
            url:'/click_adverse',
            dataType:'json',
            data:data,
            success:function(data){
            },
            error:function(xhr,type) {
              alert('save click adverse exception');
            } 
          });
          return false;
        } 
    </script>
</body>

</html>
